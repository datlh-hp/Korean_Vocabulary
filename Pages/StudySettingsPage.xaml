<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Korean_Vocabulary_new.ViewModels"
             xmlns:models="clr-namespace:Korean_Vocabulary_new.Models"
             x:Class="Korean_Vocabulary_new.Pages.StudySettingsPage"
             Title="Cài đặt học tập"
             x:DataType="viewmodels:StudySettingsViewModel">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            <!-- Number of words -->
            <Label Text="Số lượng từ vựng" FontSize="18" FontAttributes="Bold" />
            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                <Entry Grid.Column="0"
                       Text="{Binding WordCountText}"
                       Placeholder="Nhập số từ (ví dụ: 10)"
                       Keyboard="Numeric"
                       FontSize="16" />
                <Button Grid.Column="1"
                        Text="Áp dụng"
                        Clicked="OnApplyWordCount"
                        BackgroundColor="{StaticResource Primary}"
                        Padding="15,0" />
            </Grid>
            <Label Text="Nhập số từ vựng muốn học (không giới hạn)"
                   FontSize="12"
                   TextColor="{StaticResource Gray600}"
                   Margin="0,5,0,0" />

            <!-- Category filter -->
            <Label Text="Danh mục (có thể chọn nhiều)" FontSize="18" FontAttributes="Bold" Margin="0,10,0,0" />
            <Border BackgroundColor="{StaticResource Gray100}"
                StrokeThickness="0"
                Padding="15,10">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <ScrollView MaximumHeightRequest="200">
                    <CollectionView ItemsSource="{Binding Categories}"
                            SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:CategorySelectionItem">
                                <Grid Padding="0,8" ColumnDefinitions="Auto,*">
                                    <CheckBox Grid.Column="0"
                                        IsChecked="{Binding IsSelected}"
                                        VerticalOptions="Center"
                                        Margin="0,0,10,0" />
                                    <Border Grid.Column="1"
                                    BackgroundColor="{Binding Category.Color}"
                                    StrokeThickness="0"
                                    Padding="12,8">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="8" />
                                        </Border.StrokeShape>
                                        <Label Text="{Binding Category.Name}"
                                        FontSize="15"
                                        FontAttributes="Bold"
                                        TextColor="White"
                                        VerticalOptions="Center" />
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </ScrollView>
            </Border>

            <!-- Word type filter -->
            <Label Text="Lọc theo loại từ" FontSize="18" FontAttributes="Bold" Margin="0,10,0,0" />
            <Picker ItemsSource="{Binding WordTypes}"
                    SelectedItem="{Binding SelectedWordType}"
                    Title="Chọn loại từ (Tất cả = không lọc)" />

            <!-- Study mode -->
            <Label Text="Chế độ học" FontSize="18" FontAttributes="Bold" Margin="0,10,0,0" />
            <RadioButton Content="Tự động chọn (ưu tiên từ cần ôn)"
                        IsChecked="{Binding IsAutoMode}"
                        GroupName="StudyMode" />
            <RadioButton Content="Ngẫu nhiên"
                        IsChecked="{Binding IsRandomMode}"
                        GroupName="StudyMode" />

            <!-- Reverse mode -->
            <Label Text="Chế độ học ngược" FontSize="18" FontAttributes="Bold" Margin="0,10,0,0" />
            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                <VerticalStackLayout Grid.Column="0" Spacing="5">
                    <Label Text="Hiển thị nghĩa tiếng Việt, đoán từ tiếng Hàn"
                           FontSize="14"
                           TextColor="{StaticResource Gray700}" />
                    <Label Text="(Mặc định: Hiển thị từ Hàn, nhập nghĩa Việt)"
                           FontSize="12"
                           TextColor="{StaticResource Gray500}" />
                </VerticalStackLayout>
                <Switch Grid.Column="1"
                        IsToggled="{Binding IsReverseMode}"
                        VerticalOptions="Center" />
            </Grid>

            <!-- Multiple Choice mode -->
            <Label Text="Chế độ chọn đáp án" FontSize="18" FontAttributes="Bold" Margin="0,10,0,0" />
            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                <VerticalStackLayout Grid.Column="0" Spacing="5">
                    <Label Text="Chọn đáp án đúng từ 4 lựa chọn"
                           FontSize="14"
                           TextColor="{StaticResource Gray700}" />
                    <Label Text="(Mặc định: Nhập đáp án bằng text)"
                           FontSize="12"
                           TextColor="{StaticResource Gray500}" />
                </VerticalStackLayout>
                <Switch Grid.Column="1"
                        IsToggled="{Binding IsMultipleChoiceMode}"
                        VerticalOptions="Center" />
            </Grid>

            <!-- Buttons -->
            <Grid ColumnDefinitions="*,*" Margin="0,20,0,0" ColumnSpacing="10">
                <Button Grid.Column="0"
                        Text="Hủy"
                        Command="{Binding CancelCommand}"
                        BackgroundColor="{StaticResource Gray500}" />
                <Button Grid.Column="1"
                        Text="Bắt đầu học"
                        Command="{Binding StartStudyCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        IsEnabled="{Binding CanStartStudy}" />
            </Grid>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>

