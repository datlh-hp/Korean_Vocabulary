<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Korean_Vocabulary_new.ViewModels"
             xmlns:models="clr-namespace:Korean_Vocabulary_new.Models"
             x:Class="Korean_Vocabulary_new.Pages.VocabularyListPage"
             Title="Tá»« vá»±ng tiáº¿ng HÃ n"
             x:DataType="viewmodels:VocabularyListViewModel">
   
    
    <Grid RowDefinitions="Auto,*,Auto" ColumnDefinitions="Auto,*">
        <!-- Header with Search Bar and Sidebar Toggle -->
        <Border Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
                BackgroundColor="{StaticResource White}"
                StrokeThickness="0"
                Padding="0"
                Margin="0,0,0,0">
            <Grid ColumnDefinitions="Auto,*,Auto"
                  Margin="15,15,15,15">

                <Border Grid.Column="0"
                        BackgroundColor="{StaticResource SecondaryLight}"
                        StrokeThickness="0"
                        Padding="0"
                        WidthRequest="48"
                        HeightRequest="48">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <Button Command="{Binding ToggleCategoryVisibilityCommand}"
                            BackgroundColor="Transparent"
                            WidthRequest="48"
                            HeightRequest="48"
                            VerticalOptions="Center"
                            HorizontalOptions="Center"
                            ImageSource="menu_icon_71858.png"
                            Padding="0"
                            CornerRadius="12" />
                </Border>
                <Border Grid.Column="1"
                        BackgroundColor="{StaticResource Gray100}"
                        StrokeThickness="0"
                        Padding="0"
                        Margin="10,0,10,0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="15" />
                    </Border.StrokeShape>
                    <SearchBar x:Name="SearchBarControl"
                               Text="{Binding SearchText}"
                               Placeholder="TÃ¬m kiáº¿m tá»« vá»±ng..."
                               TextChanged="SearchBarControl_TextChanged"
                               BackgroundColor="Transparent"
                               PlaceholderColor="{StaticResource Gray500}"
                               Margin="10,0" />
                </Border>
                <HorizontalStackLayout Grid.Column="2"
                                       Spacing="8"
                                       VerticalOptions="Center">
                    <Border BackgroundColor="{StaticResource SecondaryLight}"
                            StrokeThickness="0"
                            Padding="0"
                            WidthRequest="40"
                            HeightRequest="40"
                            IsEnabled="{Binding IsExporting, Converter={StaticResource InvertedBoolConverter}}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="10" />
                        </Border.StrokeShape>
                        <Button Text="ðŸ“¤"
                                Command="{Binding ExportCommand}"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource Primary}"
                                FontSize="18"
                                WidthRequest="40"
                                HeightRequest="40"
                                Padding="0"
                                CornerRadius="10" />
                    </Border>
                    <Border BackgroundColor="{StaticResource SecondaryLight}"
                            StrokeThickness="0"
                            Padding="0"
                            WidthRequest="40"
                            HeightRequest="40"
                            IsEnabled="{Binding IsImporting, Converter={StaticResource InvertedBoolConverter}}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="10" />
                        </Border.StrokeShape>
                        <Button Text="ðŸ“¥"
                                Command="{Binding ImportCommand}"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource Primary}"
                                FontSize="18"
                                WidthRequest="40"
                                HeightRequest="40"
                                Padding="0"
                                CornerRadius="10" />
                    </Border>
                </HorizontalStackLayout>
            </Grid>
        </Border>
        
        <!-- Category Sidebar -->
        <Grid Grid.Row="1" Grid.Column="0"
              ColumnDefinitions="Auto,*"
              IsVisible="{Binding IsCategoryVisible}">
            <Border Grid.Column="0"
                    BackgroundColor="{StaticResource White}"
                    StrokeThickness="1"
                    Stroke="{StaticResource Gray200}"
                    WidthRequest="220"
                    Padding="0">
                <Grid RowDefinitions="Auto,*">
                    <!-- Header -->
                    <Border Grid.Row="0"
                            BackgroundColor="{StaticResource SecondaryLight}"
                            StrokeThickness="0"
                            Padding="0"
                            Margin="0,0,0,10">
                        <Grid ColumnDefinitions="*,Auto" Padding="18,15">
                            <Label Grid.Column="0"
                                   Text="Danh má»¥c"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource Primary}"
                                   VerticalOptions="Center" />
                            <Border Grid.Column="1"
                                    BackgroundColor="{StaticResource White}"
                                    StrokeThickness="0"
                                    Padding="0"
                                    WidthRequest="40"
                                    HeightRequest="40">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="10" />
                                </Border.StrokeShape>
                                <Button x:Name="SettingsButton"
                                        Command="{Binding ManageCategoriesCommand}"
                                        BackgroundColor="Transparent"
                                        WidthRequest="40"
                                        HeightRequest="40" 
                                        Padding="0"
                                        ImageSource="settings_gear_options_option_icon_icons_com_59985.png"/>
                            </Border>
                        </Grid>
                    </Border>
                    
                    <!-- Categories List -->
                    <CollectionView Grid.Row="1"
                                    ItemsSource="{Binding Categories}"
                                    SelectionMode="Single"
                                    SelectedItem="{Binding SelectedCategoryItem}"
                                    Margin="5,0">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" ItemSpacing="5" />
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:CategoryCount">
                                
                                <Border StrokeThickness="2"
                                        Stroke="{Binding data.Color}"
                                        BackgroundColor="{StaticResource Gray50}"
                                        Padding="15,12"
                                        Margin="10,5,10,5">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="12" />
                                    </Border.StrokeShape>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <Label Grid.Column="0" 
                                            Text="{Binding data.Name}"
                                            TextColor="{Binding data.Color}"
                                            FontSize="15"
                                            FontAttributes="Bold"
                                            VerticalOptions="Center"/>
                                        <Label Grid.Column="1"
                                            Text="{Binding Count}" 
                                            TextColor="{Binding data.Color}"
                                            FontSize="15"
                                            FontAttributes="Bold"
                                            VerticalOptions="Center" />
                                    </Grid>


                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Main Content Area -->
        <Grid Grid.Row="1" Grid.Column="1" RowDefinitions="Auto,*">
            <!-- Toggle Button for List -->
            <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="15,10,15,10">
                <Label Grid.Column="0"
                       Text="Danh sÃ¡ch tá»« vá»±ng"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Gray900}"
                       VerticalOptions="Center" />
                <Border Grid.Column="1"
                        BackgroundColor="{StaticResource SecondaryLight}"
                        StrokeThickness="0"
                        Padding="0"
                        WidthRequest="44"
                        HeightRequest="44">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <Button Text="{Binding IsListVisible, Converter={StaticResource BoolToToggleIconConverter}}"
                            FontSize="20"
                            Command="{Binding ToggleListVisibilityCommand}"
                            BackgroundColor="Transparent"
                            TextColor="{StaticResource Primary}"
                            WidthRequest="44"
                            HeightRequest="44"
                            Padding="0" />
                </Border>
            </Grid>

            <!-- Words List -->
            <RefreshView Grid.Row="1"
                         IsRefreshing="{Binding IsRefreshing}"
                         Command="{Binding LoadWordsCommand}"
                         IsVisible="{Binding IsListVisible}">
                <CollectionView ItemsSource="{Binding Words}"
                                SelectionMode="None"
                                SelectionChanged="OnWordSelected"
                                >
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:VocabularyWord">
                            <Border StrokeThickness="2"
                                    BackgroundColor="{StaticResource White}"
                                    Padding="18,15"
                                    Margin="12,8,12,8">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="16" />
                                </Border.StrokeShape>
                                <Border.Shadow>
                                    <Shadow Brush="{StaticResource Gray300}"
                                            Offset="0,2"
                                            Radius="8"
                                            Opacity="0.3" />
                                </Border.Shadow>
                                <Grid ColumnDefinitions="*,Auto,Auto,Auto,Auto">
                                    <!--<Grid.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnWordTapped" CommandParameter="{Binding .}" />
                                    </Grid.GestureRecognizers>-->
                                    
                                    <VerticalStackLayout Grid.Column="0" Spacing="8">
                                        <HorizontalStackLayout Spacing="10">
                                            <Label Text="{Binding KoreanWord}"
                                                   FontSize="22"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Primary}"
                                                   VerticalOptions="Center" />
                                            <Border BackgroundColor="{StaticResource SecondaryLight}"
                                                    StrokeThickness="0"
                                                    Padding="0"
                                                    IsVisible="{Binding WordType, Converter={StaticResource IsNotNullConverter}}">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="8" />
                                                </Border.StrokeShape>
                                                <Label Text="{Binding WordType}"
                                                       FontSize="11"
                                                       TextColor="{StaticResource Primary}"
                                                       BackgroundColor="Transparent"
                                                       Padding="10,5"
                                                       FontAttributes="Bold" />
                                            </Border>
                                        </HorizontalStackLayout>
                                        <Label Text="{Binding VietnameseMeaning}"
                                               FontSize="17"
                                               TextColor="{StaticResource Gray900}"
                                               Margin="0,2,0,0" />
                                        <Label Text="{Binding Pronunciation}"
                                               FontSize="14"
                                               TextColor="{StaticResource Gray500}"
                                               FontAttributes="Italic"
                                               Margin="0,2,0,0"
                                               IsVisible="{Binding Pronunciation, Converter={StaticResource IsNotNullConverter}}" />
                                    </VerticalStackLayout>

                                    <Border Grid.Column="1"
                                            BackgroundColor="{StaticResource SecondaryLight}"
                                            StrokeThickness="0"
                                            Padding="0"
                                            WidthRequest="36"
                                            HeightRequest="36"
                                            Margin="5,0">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="10" />
                                        </Border.StrokeShape>
                                        <Button Text="ðŸ”Š"
                                                Clicked="OnSpeakKoreanClicked"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="Transparent"
                                                TextColor="{StaticResource Primary}"
                                                FontSize="18"
                                                WidthRequest="36"
                                                HeightRequest="36"
                                                Padding="0"
                                                CornerRadius="10" />
                                    </Border>

                                    <Border Grid.Column="2"
                                            BackgroundColor="{StaticResource SecondaryLight}"
                                            StrokeThickness="0"
                                            Padding="0"
                                            WidthRequest="36"
                                            HeightRequest="36"
                                            Margin="5,0">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="10" />
                                        </Border.StrokeShape>
                                        <ImageButton BackgroundColor="Transparent"
                                                     Clicked="OnFavoriteClicked"
                                                     Loaded="OnStarButtonLoaded"
                                                     CommandParameter="{Binding .}"
                                                     WidthRequest="25"
                                                     HeightRequest="25"
                                                     Padding="0" />
                                    </Border>

                                    <Border Grid.Column="3"
                                            BackgroundColor="{StaticResource SecondaryLight}"
                                            StrokeThickness="0"
                                            Padding="0"
                                            WidthRequest="36"
                                            HeightRequest="36"
                                            Margin="5,0">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="10" />
                                        </Border.StrokeShape>
                                        <ImageButton Source="edit_icon_128873.png"
                                                     BackgroundColor="Transparent"
                                                     Clicked="OnEditClicked"
                                                     CommandParameter="{Binding .}"
                                                     WidthRequest="25"
                                                     HeightRequest="25"
                                                     Padding="0" />
                                    </Border>

                                    <Border Grid.Column="4"
                                            BackgroundColor="{StaticResource SecondaryLight}"
                                            StrokeThickness="0"
                                            Padding="0"
                                            WidthRequest="36"
                                            HeightRequest="36"
                                            Margin="5,0">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="10" />
                                        </Border.StrokeShape>
                                        <ImageButton Source="delete_outline_icon_148544.png"
                                                     BackgroundColor="Transparent"
                                                     Clicked="OnDeleteClicked"
                                                     CommandParameter="{Binding .}"
                                                     WidthRequest="25"
                                                     HeightRequest="25"
                                                     Padding="0" />
                                    </Border>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                    <CollectionView.EmptyView>
                        <StackLayout VerticalOptions="Center" HorizontalOptions="Center" Padding="30" Spacing="15">
                            <Label Text="ðŸ“š"
                                   FontSize="64"
                                   HorizontalOptions="Center"
                                   Opacity="0.5" />
                            <Label Text="ChÆ°a cÃ³ tá»« vá»±ng nÃ o"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource Gray700}"
                                   HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center" />
                            <Label Text="Nháº¥n nÃºt 'ThÃªm tá»«' Ä‘á»ƒ báº¯t Ä‘áº§u há»c tiáº¿ng HÃ n"
                                   FontSize="15"
                                   TextColor="{StaticResource Gray500}"
                                   HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center"
                                   Margin="0,5,0,0" />
                        </StackLayout>
                    </CollectionView.EmptyView>
                </CollectionView>
            </RefreshView>
        </Grid>

        <!-- Bottom Action Bar -->
        <Border Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                BackgroundColor="{StaticResource White}"
                StrokeThickness="1"
                Stroke="{StaticResource Gray200}"
                Padding="0"
                Margin="0">
            <Grid ColumnDefinitions="*,*,*"
                  Padding="15,12,15,12"
                  ColumnSpacing="10">
                <Button Grid.Column="0"
                        Text="Há»c táº­p"
                        Command="{Binding StudyCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        Padding="12,14"
                        FontSize="15"
                        FontAttributes="Bold"
                        CornerRadius="12"
                        TextColor="{StaticResource White}">
                    <Button.ImageSource>
                        <FileImageSource File="study_education_book_read_address_book_icon_261868.png" />
                    </Button.ImageSource>
                    <Button.Shadow>
                        <Shadow Brush="{StaticResource Primary}"
                                Offset="0,4"
                                Radius="8"
                                Opacity="0.3" />
                    </Button.Shadow>
                </Button>
                <Button Grid.Column="1"
                        Text="ThÃªm tá»«"
                        Command="{Binding AddWordCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        Padding="12,14"
                        FontSize="15"
                        FontAttributes="Bold"
                        CornerRadius="12"
                        TextColor="{StaticResource White}">
                    <Button.ImageSource>
                        <FileImageSource File="add_insert_new_plus_button_icon_142943.png" />
                    </Button.ImageSource>
                    <Button.Shadow>
                        <Shadow Brush="{StaticResource Primary}"
                                Offset="0,4"
                                Radius="8"
                                Opacity="0.3" />
                    </Button.Shadow>
                </Button>
                <Button Grid.Column="2"
                        Text="Import"
                        Command="{Binding ImportTopikCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        Padding="12,14"
                        FontSize="15"
                        FontAttributes="Bold"
                        CornerRadius="12"
                        TextColor="{StaticResource White}">
                    <Button.ImageSource>
                        <FileImageSource File="import_download_icon_143002.png" />
                    </Button.ImageSource>
                    <Button.Shadow>
                        <Shadow Brush="{StaticResource Primary}"
                                Offset="0,4"
                                Radius="8"
                                Opacity="0.3" />
                    </Button.Shadow>
                </Button>
            </Grid>
        </Border>
    </Grid>
</ContentPage>

