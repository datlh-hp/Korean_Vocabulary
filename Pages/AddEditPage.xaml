<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Korean_Vocabulary_new.ViewModels"
             xmlns:models="clr-namespace:Korean_Vocabulary_new.Models"
             x:Class="Korean_Vocabulary_new.Pages.AddEditPage"
             Title="ThÃªm/Sá»­a tá»« vá»±ng"
             x:DataType="viewmodels:AddEditViewModel">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            <!-- Korean Word -->
            <Label Text="Tá»« tiáº¿ng HÃ n *" 
                   FontSize="17" 
                   FontAttributes="Bold"
                   TextColor="{StaticResource Gray900}"
                   Margin="0,0,0,5" />
            <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10">
                <Border Grid.Column="0"
                        BackgroundColor="{StaticResource Gray100}"
                        StrokeThickness="0"
                        Padding="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <Entry Text="{Binding Word.KoreanWord}"
                           Placeholder="Nháº­p tá»« tiáº¿ng HÃ n"
                           PlaceholderColor="{StaticResource Gray900}"
                           FontSize="14"
                           BackgroundColor="Transparent"
                           Margin="15,0" />
                </Border>
                <Button Grid.Column="1"
                        Text="ðŸ”Š"
                        Command="{Binding SpeakKoreanCommand}"
                        BackgroundColor="{StaticResource SecondaryLight}"
                        TextColor="{StaticResource Primary}"
                        FontSize="20"
                        WidthRequest="50"
                        HeightRequest="50"
                        CornerRadius="12"
                        Padding="0"
                        ToolTipProperties.Text="PhÃ¡t Ã¢m tiáº¿ng HÃ n">
                    <Button.Shadow>
                        <Shadow Brush="{StaticResource SecondaryLight}"
                                Offset="0,2"
                                Radius="4"
                                Opacity="0.2" />
                    </Button.Shadow>
                </Button>
                <Button Grid.Column="2"
                        Text="âœ¨"
                        Command="{Binding AutoFillCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="{StaticResource White}"
                        FontSize="18"
                        WidthRequest="50"
                        HeightRequest="50"
                        CornerRadius="12"
                        Padding="0"
                        ToolTipProperties.Text="Tá»± Ä‘á»™ng Ä‘iá»n nghÄ©a vÃ  phÃ¡t Ã¢m">
                    <Button.Shadow>
                        <Shadow Brush="{StaticResource Primary}"
                                Offset="0,3"
                                Radius="6"
                                Opacity="0.3" />
                    </Button.Shadow>
                </Button>
            </Grid>
            
            <!-- Auto-fill loading indicator -->
            <Border IsVisible="{Binding IsAutoFilling}"
                    BackgroundColor="{StaticResource SecondaryLight}"
                    StrokeThickness="0"
                    Padding="15,10"
                    Margin="0,-10,0,0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                    <ActivityIndicator IsRunning="{Binding IsAutoFilling}"
                                     Color="{StaticResource Primary}"
                                     WidthRequest="20"
                                     HeightRequest="20" />
                    <Label Text="Äang tá»± Ä‘á»™ng Ä‘iá»n..."
                           FontSize="14"
                           TextColor="{StaticResource Primary}"
                           VerticalOptions="Center" />
                </HorizontalStackLayout>
            </Border>

            <!-- Vietnamese Meaning -->
            <Label Text="NghÄ©a tiáº¿ng Viá»‡t *" 
                   FontSize="17" 
                   FontAttributes="Bold"
                   TextColor="{StaticResource Gray900}"
                   Margin="0,0,0,5" />
            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                <Border Grid.Column="0"
                        BackgroundColor="{StaticResource Gray100}"
                        StrokeThickness="0"
                        Padding="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <Entry Text="{Binding Word.VietnameseMeaning}"
                           Placeholder="Nháº­p nghÄ©a tiáº¿ng Viá»‡t"
                           PlaceholderColor="{StaticResource Gray900}"
                           FontSize="14"
                           BackgroundColor="Transparent"
                           Margin="15,0" />
                </Border>
                <Button Grid.Column="1"
                        Text="ðŸ”Š"
                        Command="{Binding SpeakVietnameseCommand}"
                        BackgroundColor="{StaticResource SecondaryLight}"
                        TextColor="{StaticResource Primary}"
                        FontSize="20"
                        WidthRequest="50"
                        HeightRequest="50"
                        CornerRadius="12"
                        Padding="0"
                        ToolTipProperties.Text="PhÃ¡t Ã¢m tiáº¿ng Viá»‡t">
                    <Button.Shadow>
                        <Shadow Brush="{StaticResource SecondaryLight}"
                                Offset="0,2"
                                Radius="4"
                                Opacity="0.2" />
                    </Button.Shadow>
                </Button>
            </Grid>

            <!-- Pronunciation -->
            <Label Text="PhÃ¡t Ã¢m (Romanization)" 
                   FontSize="17" 
                   FontAttributes="Bold"
                   TextColor="{StaticResource Gray900}"
                   Margin="0,0,0,5" />
            <Border BackgroundColor="{StaticResource Gray100}"
                    StrokeThickness="0"
                    Padding="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Entry Text="{Binding Word.Pronunciation}"
                       Placeholder="VÃ­ dá»¥: annyeonghaseyo"
                       PlaceholderColor="{StaticResource Gray900}"
                       FontSize="14"
                       BackgroundColor="Transparent"
                       Margin="15,0" />
            </Border>

            <!-- Category -->
            <Label Text="Danh má»¥c (cÃ³ thá»ƒ chá»n nhiá»u)" 
                   FontSize="17" 
                   FontAttributes="Bold"
                   TextColor="{StaticResource Gray900}"
                   Margin="0,0,0,5" />
            <Border BackgroundColor="{StaticResource Gray100}"
                    StrokeThickness="0"
                    Padding="15,10">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <ScrollView MaximumHeightRequest="200">
                    <CollectionView ItemsSource="{Binding CategorySelections}"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:CategorySelectionItem">
                                <Grid Padding="0,8" ColumnDefinitions="Auto,*">
                                    <CheckBox Grid.Column="0"
                                             IsChecked="{Binding IsSelected}"
                                             VerticalOptions="Center"
                                             Margin="0,0,10,0" />
                                    <Border Grid.Column="1"
                                            BackgroundColor="{Binding Category.Color}"
                                            StrokeThickness="0"
                                            Padding="12,8">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="8" />
                                        </Border.StrokeShape>
                                        <Label Text="{Binding Category.Name}"
                                               FontSize="15"
                                               FontAttributes="Bold"
                                               TextColor="White"
                                               VerticalOptions="Center" />
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </ScrollView>
            </Border>

            <!-- Word Type -->
            <Label Text="Loáº¡i tá»«" 
                   FontSize="17" 
                   FontAttributes="Bold"
                   TextColor="{StaticResource Gray900}"
                   Margin="0,0,0,5" />
            <Border BackgroundColor="{StaticResource Gray100}"
                    StrokeThickness="0"
                    Padding="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Picker ItemsSource="{Binding WordTypes}"
                        SelectedItem="{Binding SelectedWordType}"
                        Title="Chá»n loáº¡i tá»«"
                        BackgroundColor="Transparent"
                        Margin="10,0" />
            </Border>

            <!-- Example Sentence -->
            <Label Text="VÃ­ dá»¥ cÃ¢u" 
                   FontSize="17" 
                   FontAttributes="Bold"
                   TextColor="{StaticResource Gray900}"
                   Margin="0,0,0,5" />
            <Grid RowDefinitions="*,Auto" RowSpacing="10">
                <Border Grid.Row="0"
                        BackgroundColor="{StaticResource Gray100}"
                        StrokeThickness="0"
                        Padding="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <Editor Text="{Binding Word.ExampleSentence}"
                            Placeholder="Nháº­p cÃ¢u vÃ­ dá»¥ báº±ng tiáº¿ng HÃ n"
                            HeightRequest="100"
                            PlaceholderColor="{StaticResource Gray900}"
                            FontSize="14"
                            BackgroundColor="Transparent"
                            Margin="15,10" />
                </Border>
                <Button Grid.Row="1"
                        Text="âœ¨ Dá»‹ch tá»± Ä‘á»™ng"
                        Command="{Binding TranslateExampleCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="{StaticResource White}"
                        FontSize="14"
                        FontAttributes="Bold"
                        Padding="15,10"
                        CornerRadius="12"
                        HorizontalOptions="End">
                    <Button.Shadow>
                        <Shadow Brush="{StaticResource Primary}"
                                Offset="0,3"
                                Radius="6"
                                Opacity="0.3" />
                    </Button.Shadow>
                </Button>
            </Grid>
            
            <!-- Example translation loading indicator -->
            <Border IsVisible="{Binding IsTranslatingExample}"
                    BackgroundColor="{StaticResource SecondaryLight}"
                    StrokeThickness="0"
                    Padding="15,10"
                    Margin="0,-10,0,0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                    <ActivityIndicator IsRunning="{Binding IsTranslatingExample}"
                                     Color="{StaticResource Primary}"
                                     WidthRequest="20"
                                     HeightRequest="20" />
                    <Label Text="Äang dá»‹ch cÃ¢u vÃ­ dá»¥..."
                           FontSize="14"
                           TextColor="{StaticResource Primary}"
                           VerticalOptions="Center" />
                </HorizontalStackLayout>
            </Border>

            <!-- Example Translation -->
            <Label Text="Dá»‹ch cÃ¢u vÃ­ dá»¥" 
                   FontSize="17" 
                   FontAttributes="Bold"
                   TextColor="{StaticResource Gray900}"
                   Margin="0,0,0,5" />
            <Border BackgroundColor="{StaticResource Gray100}"
                    StrokeThickness="0"
                    Padding="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Editor Text="{Binding Word.ExampleTranslation}"
                        Placeholder="Nháº­p báº£n dá»‹ch cÃ¢u vÃ­ dá»¥"
                        HeightRequest="100"
                        PlaceholderColor="{StaticResource Gray900}"
                        FontSize="14"
                        BackgroundColor="Transparent"
                        Margin="15,10" />
            </Border>

            <!-- Difficulty Level -->
            <Label Text="Äá»™ khÃ³ (1-5)" 
                   FontSize="17" 
                   FontAttributes="Bold"
                   TextColor="{StaticResource Gray900}"
                   Margin="0,0,0,5" />
            <Border BackgroundColor="{StaticResource Gray100}"
                    StrokeThickness="0"
                    Padding="15,15">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="10">
                    <Slider Minimum="1"
                            Maximum="5"
                            Value="{Binding Word.DifficultyLevel}"
                            ValueChanged="OnDifficultyChanged"
                            MinimumTrackColor="{StaticResource Primary}"
                            MaximumTrackColor="{StaticResource Gray300}"
                            ThumbColor="{StaticResource Primary}" />
                    <Label x:Name="DifficultyLabel"
                           Text="{Binding Word.DifficultyLevel, StringFormat='Äá»™ khÃ³: {0}'}"
                           FontSize="15"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}"
                           HorizontalOptions="Center" />
                </VerticalStackLayout>
            </Border>

            <!-- Favorite -->
            <Border BackgroundColor="{StaticResource Gray100}"
                    StrokeThickness="0"
                    Padding="15,15">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <HorizontalStackLayout Spacing="15">
                    <Switch IsToggled="{Binding Word.IsFavorite}"
                            OnColor="{StaticResource Primary}"
                            ThumbColor="{StaticResource White}"
                            VerticalOptions="Center" />
                    <Label Text="ÄÃ¡nh dáº¥u yÃªu thÃ­ch"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Gray900}"
                           VerticalOptions="Center" />
                </HorizontalStackLayout>
            </Border>

            <!-- Buttons -->
            <Grid ColumnDefinitions="*,*" Margin="0,25,0,0" ColumnSpacing="12">
                <Button Grid.Column="0"
                        Text="Há»§y"
                        Command="{Binding CancelCommand}"
                        BackgroundColor="{StaticResource Gray400}"
                        TextColor="{StaticResource White}"
                        FontSize="16"
                        FontAttributes="Bold"
                        Padding="0,16"
                        CornerRadius="12">
                    <Button.Shadow>
                        <Shadow Brush="{StaticResource Gray400}"
                                Offset="0,3"
                                Radius="6"
                                Opacity="0.2" />
                    </Button.Shadow>
                </Button>
                <Button Grid.Column="1"
                        Text="LÆ°u"
                        Command="{Binding SaveCommand}"
                        IsEnabled="{Binding IsValid}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="{StaticResource White}"
                        FontSize="16"
                        FontAttributes="Bold"
                        Padding="0,16"
                        CornerRadius="12">
                    <Button.Shadow>
                        <Shadow Brush="{StaticResource Primary}"
                                Offset="0,4"
                                Radius="8"
                                Opacity="0.3" />
                    </Button.Shadow>
                </Button>
            </Grid>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>

